<query-editor-row query-ctrl="ctrl" ng-if="!ctrl.datasource.metricNames">
    <div class="gf-form-inline">
        <div class="gf-form">
            <label class="gf-form-label">
                Loading metric names... <span class="fa fa-spinner fa-spin"></span>
            </label>
        </div>
        <div class="gf-form gf-form--grow">
            <div class="gf-form-label gf-form-label--grow"></div>
        </div>
    </div>
</query-editor-row>
<query-editor-row query-ctrl="ctrl" can-collapse="false" ng-if="ctrl.datasource.metricNames">
    <div class="gf-form-inline">
        <div class="gf-form">
            <div class="gf-form">
                <label class="gf-form-label query-keyword width-8">
                    Metric
                    <label class="gf-form-label" bs-tooltip="ctrl.errors.metric" style="color: rgb(229, 189, 28)"
                           ng-show="ctrl.errors.metric">
                        <i class="fa fa-warning"></i>
                    </label>
                </label>
            </div>
        </div>
        <div class="gf-form">
            <metric-name-field></metric-name-field>
        </div>
        <div class="gf-form gf-form--grow">
            <div class="gf-form-label gf-form-label--grow"></div>
        </div>
    </div>

    <div class="gf-form-group">
        <div class="gf-form-inline">
            <div class="gf-form">
                <label class="gf-form-label query-keyword width-8">
                    Tags
                </label>
            </div>
            <div class="gf-form">
                <label class="gf-form-label" ng-show="ctrl.tagsLoading">
                    Loading tags... <span class="fa fa-spinner fa-spin"></span>
                </label>
                <label class="gf-form-label" ng-show="!ctrl.tagsLoading">
                    <b>{{ctrl.tagsOptions.length}} tags, {{ctrl.tagsCombinations}} combinations</b>
                </label>
            </div>
            <div class="gf-form gf-form--grow">
                <div class="gf-form-label gf-form-label--grow"></div>
            </div>
        </div>
        <tags-select ng-repeat="tagOption in ctrl.tagsOptions"></tags-select>
    </div>
    <div ng-if="!ctrl.tagsLoading && ctrl.allowedGroupByTags" class="gf-form-group">
        <div class="gf-form-inline">
            <div class="gf-form">
                <label class="gf-form-label query-keyword width-8">
                    Group by
                </label>
            </div>
            <div class="gf-form">
                <label class="gf-form-label width-5">
                    Tag
                </label>
            </div>
            <div class="gf-form" ng-repeat="tagName in ctrl.allowedGroupByTags">
                <label class="gf-form-label">
                    <a ng-click="ctrl.toggleGroupByTag(tagName)"
                       ng-class="ctrl.isActiveGroupByTag(tagName) ? 'activeTag' : 'inactiveTag'">{{tagName}}</a>
                </label>
            </div>
            <div class="gf-form" ng-show="ctrl.allowedGroupByTags.length == 0">
                <label class="gf-form-label">
                    No tags to group by
                </label>
            </div>
            <div class="gf-form gf-form--grow">
                <div class="gf-form-label gf-form-label--grow"></div>
            </div>
        </div>
        <div class="gf-form-inline">
            <div class="gf-form">
                <label class="gf-form-label offset-width-8 width-5">
                    <!--todo: mulitple values?-->
                    Value
                </label>
            </div>
            <div class="gf-form gf-form--grow">
                <div class="gf-form-label gf-form-label--grow"></div>
            </div>
        </div>
        <div class="gf-form-inline">
            <div class="gf-form">
                <label class="gf-form-label offset-width-8 width-5">
                    Time
                </label>
            </div>
            <div class="gf-form gf-form--grow">
                <div class="gf-form-label gf-form-label--grow"></div>
            </div>
        </div>
    </div>
    <div class="gf-form-inline">
        <div class="gf-form">
            <div class="gf-form">
                <label class="gf-form-label query-keyword width-8">
                    Aggregators
                </label>
            </div>
        </div>
        <div class="gf-form">
            <!--todo: ng-model-->
            <select>
                <option ng-repeat="aggregator in ctrl.aggregators" value="{{aggregator.name}}">{{aggregator.name}}</option>
            </select>
        </div>
        <div class="gf-form gf-form--grow">
            <div class="gf-form-label gf-form-label--grow"></div>
        </div>
    </div>
</query-editor-row>